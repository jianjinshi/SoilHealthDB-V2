TRUE ~ as.character(Category)
)
)
#Bootstrap sampling
boots_startyear <- function(sdata, n_rep = 5000) {
results_list <- list()
for (cat in unique(sdata$Category)) {
subdata <- sdata %>% filter(Category == cat)
values <- subdata$StartYear
if (length(values) < 3) next
mysamples <- replicate(n_rep, sample(values, replace = TRUE))
mymeans <- apply(mysamples, 2, mean, na.rm = TRUE)
results_list[[cat]] <- tibble(
Category = cat,
BootMean = mymeans
)
}
bind_rows(results_list)
}
boot_results <- boots_startyear(duration_long, n_rep = 5000)
boot_results$Category <- factor(boot_results$Category,
levels = c("Medium term", "Long term"))
# 计算每组的平均值-----------------------------------------------------------------
mean_points <- boot_results %>%
group_by(Category) %>%
summarise(MeanValue = mean(BootMean, na.rm = TRUE))
p <- ggplot(boot_results, aes(x = Category, y = BootMean, fill = Category)) +
geom_boxplot(
width = 0.25,
alpha = 0.8,
outlier.shape = NA,
position = position_nudge(x = -0.15),
color = "black"
) +
geom_half_violin(
position = position_nudge(x = +0.15),
side = "r",
width = 0.9,
alpha = 0.6,
trim = FALSE,
color = "black"
) +
# 添加红色三角表示 mean----------------------------------------------------
geom_point(
data = mean_points,
aes(x = Category, y = MeanValue),
color = "red",
shape = 17,
size = 2
) +
scale_y_continuous(
limits = c(3, 12),
breaks = seq(3, 12, 1)
) +
scale_fill_manual(values = c("Medium term" = "#0173B2", "Long term" = "black")) +
labs(
x = NULL,
y = "Start years (n)"
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 1),
axis.ticks = element_line(color = "black"),
axis.ticks.length = unit(0.2, "cm"),
panel.grid = element_blank(),
axis.text.x = element_text(size = 12)
)
print(p)
ggsave("outputs/Figure_S2--.jpg", p, width = 4, height = 5, units = "in", dpi = 300)
ggsave("outputs/Figure_S2--.pdf", p, width = 4, height = 5, units = "in", dpi = 300)
library(tidyverse)
library(gghalves)
duration <- read_csv("data/other_data/medium and long-term start year.csv")
duration_long <- duration %>%
pivot_longer(
cols = c(Medium_start_year, Long_start_year),
names_to = "Category",
values_to = "StartYear",
values_drop_na = TRUE
) %>%
mutate(
Category = case_when(
Category == "Medium_start_year" ~ "Medium term",
Category == "Long_start_year"   ~ "Long term",
TRUE ~ as.character(Category)
)
)
#Bootstrap sampling
boots_startyear <- function(sdata, n_rep = 5000) {
results_list <- list()
for (cat in unique(sdata$Category)) {
subdata <- sdata %>% filter(Category == cat)
values <- subdata$StartYear
if (length(values) < 3) next
mysamples <- replicate(n_rep, sample(values, replace = TRUE))
mymeans <- apply(mysamples, 2, mean, na.rm = TRUE)
results_list[[cat]] <- tibble(
Category = cat,
BootMean = mymeans
)
}
bind_rows(results_list)
}
boot_results <- boots_startyear(duration_long, n_rep = 5000)
boot_results$Category <- factor(boot_results$Category,
levels = c("Medium term", "Long term"))
# 计算每组的平均值-----------------------------------------------------------------
mean_points <- boot_results %>%
group_by(Category) %>%
summarise(MeanValue = mean(BootMean, na.rm = TRUE))
p <- ggplot(boot_results, aes(x = Category, y = BootMean, fill = Category)) +
geom_boxplot(
width = 0.25,
alpha = 0.8,
outlier.shape = NA,
position = position_nudge(x = -0.15),
color = "black"
) +
geom_half_violin(
position = position_nudge(x = +0.15),
side = "r",
width = 0.9,
alpha = 0.6,
trim = FALSE,
color = "black"
) +
# 添加红色三角表示 mean----------------------------------------------------
geom_point(
data = mean_points,
aes(x = Category, y = MeanValue),
color = "red",
shape = 17,
size = 2，
library(tidyverse)
library(gghalves)
duration <- read_csv("data/other_data/medium and long-term start year.csv")
duration_long <- duration %>%
pivot_longer(
cols = c(Medium_start_year, Long_start_year),
names_to = "Category",
values_to = "StartYear",
values_drop_na = TRUE
) %>%
mutate(
Category = case_when(
Category == "Medium_start_year" ~ "Medium term",
Category == "Long_start_year"   ~ "Long term",
TRUE ~ as.character(Category)
)
)
#Bootstrap sampling
boots_startyear <- function(sdata, n_rep = 5000) {
results_list <- list()
for (cat in unique(sdata$Category)) {
subdata <- sdata %>% filter(Category == cat)
values <- subdata$StartYear
if (length(values) < 3) next
mysamples <- replicate(n_rep, sample(values, replace = TRUE))
mymeans <- apply(mysamples, 2, mean, na.rm = TRUE)
results_list[[cat]] <- tibble(
Category = cat,
BootMean = mymeans
)
}
bind_rows(results_list)
}
boot_results <- boots_startyear(duration_long, n_rep = 5000)
boot_results$Category <- factor(boot_results$Category,
levels = c("Medium term", "Long term"))
# 计算每组的平均值-----------------------------------------------------------------
mean_points <- boot_results %>%
group_by(Category) %>%
summarise(MeanValue = mean(BootMean, na.rm = TRUE))
p <- ggplot(boot_results, aes(x = Category, y = BootMean, fill = Category)) +
geom_boxplot(
width = 0.25,
alpha = 0.8,
outlier.shape = NA,
position = position_nudge(x = -0.15),
color = "black"
) +
geom_half_violin(
position = position_nudge(x = +0.15),
side = "r",
width = 0.9,
alpha = 0.6,
trim = FALSE,
color = "black"
) +
# 添加红色三角表示 mean----------------------------------------------------
geom_point(
data = mean_points,
aes(x = Category, y = MeanValue),
color = "red",
shape = 17,
size = 2,
position = position_nudge(x = -0.15)
) +
scale_y_continuous(
limits = c(3, 12),
breaks = seq(3, 12, 1)
) +
scale_fill_manual(values = c("Medium term" = "#0173B2", "Long term" = "black")) +
labs(
x = NULL,
y = "Start years (n)"
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 1),
axis.ticks = element_line(color = "black"),
axis.ticks.length = unit(0.2, "cm"),
panel.grid = element_blank(),
axis.text.x = element_text(size = 12)
)
print(p)
ggsave("outputs/Figure_S2--.jpg", p, width = 4, height = 5, units = "in", dpi = 300)
ggsave("outputs/Figure_S2--.pdf", p, width = 4, height = 5, units = "in", dpi = 300)
library(tidyverse)
library(gghalves)
duration <- read_csv("data/other_data/medium and long-term start year.csv")
duration_long <- duration %>%
pivot_longer(
cols = c(Medium_start_year, Long_start_year),
names_to = "Category",
values_to = "StartYear",
values_drop_na = TRUE
) %>%
mutate(
Category = case_when(
Category == "Medium_start_year" ~ "Medium term",
Category == "Long_start_year"   ~ "Long term",
TRUE ~ as.character(Category)
)
)
#Bootstrap sampling
boots_startyear <- function(sdata, n_rep = 5000) {
results_list <- list()
for (cat in unique(sdata$Category)) {
subdata <- sdata %>% filter(Category == cat)
values <- subdata$StartYear
if (length(values) < 3) next
mysamples <- replicate(n_rep, sample(values, replace = TRUE))
mymeans <- apply(mysamples, 2, mean, na.rm = TRUE)
results_list[[cat]] <- tibble(
Category = cat,
BootMean = mymeans
)
}
bind_rows(results_list)
}
boot_results <- boots_startyear(duration_long, n_rep = 5000)
boot_results$Category <- factor(boot_results$Category,
levels = c("Medium term", "Long term"))
# 计算每组的平均值-----------------------------------------------------------------
mean_points <- boot_results %>%
group_by(Category) %>%
summarise(MeanValue = mean(BootMean, na.rm = TRUE))
p <- ggplot(boot_results, aes(x = Category, y = BootMean, fill = Category)) +
geom_boxplot(
width = 0.25,
alpha = 0.8,
outlier.shape = NA,
position = position_nudge(x = -0.15),
color = "black"
) +
geom_half_violin(
position = position_nudge(x = +0.15),
side = "r",
width = 0.9,
alpha = 0.6,
trim = FALSE,
color = "black"
) +
# 添加红色三角表示 mean----------------------------------------------------
geom_point(
data = mean_points,
aes(x = Category, y = MeanValue),
color = "red",
shape = 17,
size = 2,
position = position_nudge(x = -0.15)
) +
scale_y_continuous(
limits = c(3, 12),
breaks = seq(3, 12, 1)
) +
scale_fill_manual(values = c("Medium term" = "#0173B2", "Long term" = "black")) +
labs(
x = NULL,
y = "Duration year (n)"
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 1),
axis.ticks = element_line(color = "black"),
axis.ticks.length = unit(0.2, "cm"),
panel.grid = element_blank(),
axis.text.x = element_text(size = 12)
)
print(p)
ggsave("outputs/Figure_S2--.jpg", p, width = 4, height = 5, units = "in", dpi = 300)
ggsave("outputs/Figure_S2--.pdf", p, width = 4, height = 5, units = "in", dpi = 300)
library(tidyverse)
library(gghalves)
duration <- read_csv("data/other_data/medium and long-term start year.csv")
duration_long <- duration %>%
pivot_longer(
cols = c(Medium_start_year, Long_start_year),
names_to = "Category",
values_to = "StartYear",
values_drop_na = TRUE
) %>%
mutate(
Category = case_when(
Category == "Medium_start_year" ~ "Medium term",
Category == "Long_start_year"   ~ "Long term",
TRUE ~ as.character(Category)
)
)
# Bootstrap sampling ---------------------------------------------------------
boots_startyear <- function(sdata, n_rep = 5000) {
results_list <- list()
for (cat in unique(sdata$Category)) {
subdata <- sdata %>% filter(Category == cat)
values <- subdata$StartYear
if (length(values) < 3) next
mysamples <- replicate(n_rep, sample(values, replace = TRUE))
mymeans <- apply(mysamples, 2, mean, na.rm = TRUE)
results_list[[cat]] <- tibble(
Category = cat,
BootMean = mymeans
)
}
bind_rows(results_list)
}
boot_results <- boots_startyear(duration_long, n_rep = 5000)
boot_results$Category <- factor(boot_results$Category,
levels = c("Medium term", "Long term"))
# 计算 mean 和 95% CI --------------------------------------------------------
mean_points <- boot_results %>%
group_by(Category) %>%
summarise(
MeanValue = mean(BootMean, na.rm = TRUE),
CI_low = quantile(BootMean, 0.025, na.rm = TRUE),
CI_high = quantile(BootMean, 0.975, na.rm = TRUE)
) %>%
mutate(
Label = sprintf("%.2f ± %.2f", MeanValue, (CI_high - CI_low)/2)
)
# 绘图 -----------------------------------------------------------------------
p <- ggplot(boot_results, aes(x = Category, y = BootMean, fill = Category)) +
geom_boxplot(
width = 0.25,
alpha = 0.8,
outlier.shape = NA,
position = position_nudge(x = -0.15),
color = "black"
) +
geom_half_violin(
position = position_nudge(x = +0.15),
side = "r",
width = 0.9,
alpha = 0.6,
trim = FALSE,
color = "black"
) +
# 红色三角表示 mean
geom_point(
data = mean_points,
aes(x = Category, y = MeanValue),
color = "red",
shape = 17,
size = 2,
position = position_nudge(x = -0.15)
) +
# 在红三角上方标注 mean ± 95% CI
geom_text(
data = mean_points,
aes(x = Category, y = MeanValue + 0.4, label = Label),
color = "red",
size = 3.5,
fontface = "italic",
position = position_nudge(x = -0.15)
) +
scale_y_continuous(
limits = c(3, 12),
breaks = seq(3, 12, 1)
) +
scale_fill_manual(values = c("Medium term" = "#0173B2", "Long term" = "black")) +
labs(
x = NULL,
y = "Duration year (n)"
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 1),
axis.ticks = element_line(color = "black"),
axis.ticks.length = unit(0.2, "cm"),
panel.grid = element_blank(),
axis.text.x = element_text(size = 12)
)
print(p)
ggsave("outputs/Figure_S2--.jpg", p, width = 4, height = 5, units = "in", dpi = 300)
ggsave("outputs/Figure_S2--.pdf", p, width = 4, height = 5, units = "in", dpi = 300)
library(tidyverse)
library(gghalves)
duration <- read_csv("data/other_data/medium and long-term start year.csv")
duration_long <- duration %>%
pivot_longer(
cols = c(Medium_start_year, Long_start_year),
names_to = "Category",
values_to = "StartYear",
values_drop_na = TRUE
) %>%
mutate(
Category = case_when(
Category == "Medium_start_year" ~ "Medium term",
Category == "Long_start_year"   ~ "Long term",
TRUE ~ as.character(Category)
)
)
# Bootstrap sampling ---------------------------------------------------------
boots_startyear <- function(sdata, n_rep = 5000) {
results_list <- list()
for (cat in unique(sdata$Category)) {
subdata <- sdata %>% filter(Category == cat)
values <- subdata$StartYear
if (length(values) < 3) next
mysamples <- replicate(n_rep, sample(values, replace = TRUE))
mymeans <- apply(mysamples, 2, mean, na.rm = TRUE)
results_list[[cat]] <- tibble(
Category = cat,
BootMean = mymeans
)
}
bind_rows(results_list)
}
boot_results <- boots_startyear(duration_long, n_rep = 5000)
boot_results$Category <- factor(boot_results$Category,
levels = c("Medium term", "Long term"))
# 计算 mean 和 95% CI --------------------------------------------------------
mean_points <- boot_results %>%
group_by(Category) %>%
summarise(
MeanValue = mean(BootMean, na.rm = TRUE),
CI_low = quantile(BootMean, 0.025, na.rm = TRUE),
CI_high = quantile(BootMean, 0.975, na.rm = TRUE)
) %>%
mutate(
Label = sprintf("%.2f ± %.2f", MeanValue, (CI_high - CI_low)/2)
)
# 绘图 -----------------------------------------------------------------------
p <- ggplot(boot_results, aes(x = Category, y = BootMean, fill = Category)) +
geom_boxplot(
width = 0.25,
alpha = 0.8,
outlier.shape = NA,
position = position_nudge(x = -0.15),
color = "black"
) +
geom_half_violin(
position = position_nudge(x = +0.15),
side = "r",
width = 0.9,
alpha = 0.6,
trim = FALSE,
color = "black"
) +
# 红色三角表示 mean
geom_point(
data = mean_points,
aes(x = Category, y = MeanValue),
color = "red",
shape = 17,
size = 2,
position = position_nudge(x = -0.15)
) +
# 在红三角上方标注 mean ± 95% CI
geom_text(
data = mean_points,
aes(x = Category, y = MeanValue + 0.7, label = Label),
color = "red",
size = 3.5,
fontface = "italic",
position = position_nudge(x = -0.15)
) +
scale_y_continuous(
limits = c(3, 12),
breaks = seq(3, 12, 1)
) +
scale_fill_manual(values = c("Medium term" = "#0173B2", "Long term" = "black")) +
labs(
x = NULL,
y = "Duration year (n)"
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 1),
axis.ticks = element_line(color = "black"),
axis.ticks.length = unit(0.2, "cm"),
panel.grid = element_blank(),
axis.text.x = element_text(size = 12)
)
print(p)
ggsave("outputs/Figure_S2--.jpg", p, width = 4, height = 5, units = "in", dpi = 300)
ggsave("outputs/Figure_S2--.pdf", p, width = 4, height = 5, units = "in", dpi = 300)
